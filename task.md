# Видение системы верификации: полное структурированное описание

Версия: **v1.0**  ·  Дата: **2025‑10‑08**

---

## 0) Резюме

Система верификации состоит из двух частей: **клиент** (заполняет данные и отправляет подтверждения) и **админ** (проверяет и принимает решения). Верифицируются четыре направления: **Почта, Номер, Адрес, Документы**. У каждого направления есть единые статусы и чёткая логика переходов, блокировок полей и перемещения карточек между секциями админ‑панели. В карточках админа отображается **только ID** клиента. Все секции админ‑панели изначально **свёрнуты**; сверху доступен **глобальный поиск**.

---

## 1) Термины и роли

* **Клиент** — пользователь, который заполняет профиль и инициирует подтверждение отдельных направлений.
* **Админ** — сотрудник, который проверяет запросы, подтверждает/отклоняет и ведёт историю.
* **Направления верификации (4):**

  * **Почта**
  * **Номер** (телефон)
  * **Адрес**
  * **Документы**
* **Счётчик прогресса:** `x/4`, где `x` — число направлений со статусом ✅.

---

## 2) Единые статусы (для клиента и админа)

| Статус                      | Значок    | Что означает                                        | Доступность действий                                                                           |
| --------------------------- | --------- | --------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| **Нет запроса / неактивно** | ◻️ Серый  | По направлению нет активного процесса               | Элемент некликабелен, поля редактируемы у клиента                                              |
| **На проверке**             | ❓ Жёлтый  | Клиент отправил на проверку, решение ещё не принято | Клиент: «Отменить запрос». Админ: «Подтвердить/Отклонить» + комментарий                        |
| **Подтверждено**            | ✅ Зелёный | Направление верифицировано                          | Клиент: только просмотр. Админ: только просмотр; возможен **сброс** из секции «Верифицировано» |
| **Отказано**                | ❌ Красный | Запрос отклонён с комментарием                      | Клиент: видно текст комментария, доступна кнопка «Повторно»                                    |

> Правило единообразия: **серый** везде трактуется как «неактивно/некликабельно/ничего не происходит».

---

## 3) Клиент: профиль и верификация

### 3.1 profile/personal (профиль)

* Поле, использованное при регистрации (**почта или номер**), сразу **заблокировано** для редактирования.
* Если клиент добавляет недостающее контактное поле (например, номер при регистрации по почте), на вкладке **profile/verification** появляется кнопка **«Подтвердить»** для соответствующего направления.
* **Предусловия для доступности «Подтвердить»:**

  * **Почта/Номер:** корректно заполнено соответствующее поле.
  * **Адрес:** заполнены поля **Страна / Город / Адрес**, а также в профиле заданы **Имя, Фамилия, Пол, Дата рождения**.
  * **Документы:** доступны после заполнения обязательных персональных данных; создаётся запрос с загрузкой файлов.

### 3.2 profile/verification (верификация на стороне клиента)

* По каждому направлению отображается статусная плашка с иконкой и (при возможности) кнопкой **«Подтвердить»**.
* После нажатия **«Подтвердить»** статус становится **❓**, профильные поля по направлению **блокируются**.
* При статусах **◻️** или **❌** поля по направлению **редактируемы**, можно повторно отправить на проверку.
* При **❌** клиент видит **комментарий** (только текст, без ID и имени проверяющего) и кнопку **«Повторно»**.
* Дополнительная кнопка на **❓**: **«Отменить запрос»** (пока админ не начал обработку). Возвращает статус в **◻️** и разблокирует поля.
* Раздел **«Статусы верификации»** показывает четыре направления и их индикаторы, а также суммарный прогресс **`x/4`**.

---

## 4) Админ: страница admin/verification

### 4.1 Верхняя панель

* **Глобальный поиск** по полям: **Имя, Фамилия, Почта, ID, Телефон**. Работает по частичным совпадениям.
* Результаты поиска подсвечиваются; при переходе к карточке целевой **аккордион разворачивается автоматически**.

### 4.2 Секции (аккордионы)

* 4 секции, **по умолчанию свёрнуты**:

  1. **Запросы на верификацию**
  2. **Частичная верификация**
  3. **Отказано**
  4. **Верифицировано**
* В заголовке секции: название + **счётчик карточек**; при необходимости — быстрые фильтры (например, «Номер: ❓»).

### 4.3 Карточка клиента (во всех секциях)

* Отображает **только ID** клиента + **время** последнего действия.
* Четыре маленьких индикатора по направлениям (**Почта / Номер / Адрес / Документы**) и общий прогресс **`x/4`**.
* Никаких надписей «нажмите, чтобы открыть» — по клику карточка открывает модалку.

### 4.4 Модальное окно карточки

* 4 вкладки: **Почта / Номер / Адрес / Документы**.
* Состояния вкладок:

  * **◻️ Серый** — нет активного запроса (некликабельно).
  * **❓ Жёлтый** — доступны **Подтвердить / Отклонить**; поле **комментария** (при отказе обязательно).
  * **✅ Зелёный** — **read‑only**; доступен просмотр данных и истории.
  * **❌ Красный** — read‑only для клиента; у админа доступно формирование комментария уже совершённого отказа в истории (редактировать сам отказ нельзя).
* **Адрес:** доступен «карандаш» для корректировок форматирования (опечатки, регистр, пробелы и т. п.). Все правки фиксируются в истории (дата, админ, что изменено).
* **Документы:** админ видит загруженные файлы/превью, сравнивает с данными профиля.
* **История по направлению:** хронологический лог: дата/время, действие, комментарий, админ. (Имена админов видны только админам; клиенту — нет.)

---

## 5) Правила блокировок и доступности

* **Клиент:**

  * На **❓/✅** — поля по направлению **заблокированы**.
  * На **◻️/❌** — поля **редактируемы**.
  * На **❓** — доступна **«Отменить запрос»** до начала обработки.
* **Админ:**

  * Может вносить корректировки только в блоке **Адрес** («карандаш»), с записью в историю.
  * Для **Подтвердить/Отклонить** по любому направлению требуется явное действие; при **Отклонить** комментарий **обязателен**.
  * **Сброс верификации** доступен из секции **«Верифицировано»** по каждому направлению (обязателен комментарий).

---

## 6) Логика перемещений между секциями админ‑панели

* **Подтверждение** направления:

  * Если после действия стало **`4/4`** — карточка перемещается в **«Верифицировано»**.
  * Иначе — в **«Частичную верификацию»**.
* **Отклонение** любого направления → карточка попадает в **«Отказано»** (до повторной подачи клиентом).
* Если из **«Частичной»** клиент подал новый запрос по одному из направлений, карточка также появляется в **«Запросах…»** (на время рассмотрения этого направления), при этом уже подтверждённые направления остаются **✅**.
* **Сброс** (из «Верифицировано»): статус выбранного направления → **◻️**, счётчик уменьшается (**`4/4 → 3/4`**), карточка уходит в **«Частичную»**.

---

## 7) Поиск и фильтрация

* Поиск глобальный (Имя/Фамилия/Почта/ID/Телефон), работает сквозь все секции и свёрнутые состояния.
* По клику на найденную карточку целевой аккордион **автоматически разворачивается**.
* Дополнительные фильтры по статусам направлений (например, показать все карточки, где **Номер = ❓**).

---

## 8) UX‑правила и доступность

* Все 4 секции админ‑панели изначально **свёрнуты** (аккордионы).
* Иконки статусов всегда сопровождаются текстовыми ярлыками (для пользователей с нарушениями восприятия цвета).
* Кнопки и действия имеют чёткие подсказки (тултипы), если недоступны (например, «Заполните Страна/Город/Адрес + Имя/Фамилия/Пол/ДР» для **Адреса**).
* Никаких лишних инструкций в карточках (например, «нажмите, чтобы открыть») — кликабельность очевидна по всему элементу.

---

## 9) Потенциальные тупики и решения (финальная версия)

1. **Клиент заметил ошибку после отправки (❓):** есть кнопка **«Отменить запрос»** (до начала обработки) → статус **◻️**, поля разблокированы.
2. **SLA‑напоминания**: **не используем** (исключены).
3. **Счётчик `x/4`**: вычисляется по фактическим ✅; сброс/отклонение мгновенно пересчитывает прогресс и перемещает карточку в нужную секцию.
4. **Конкурентные правки адреса**: при **❓** клиент заблокирован; админ может править адрес с версионированием в истории.
5. **Повторная подача после ❌**: комментарий отказа виден рядом с кнопкой **«Повторно»**.
6. **Пояснения доступности «Подтвердить»**: есть явные предусловия по каждому из 4 направлений + тултипы и подсветка незаполненных полей.
7. **Единое толкование серого**: всегда «неактивно/некликабельно/ничего не происходит».
8. **История действий**: централизованная по каждому направлению; клиент видит только текст отказов (без ID/имён админов).
9. **Поиск в свёрнутых секциях**: глобальный, с авто‑разворачиванием целевого аккордиона.

---

## 10) Мини‑модель данных (для ориентира)

* **Direction**: `email | phone | address | documents`.
* **Status**: `idle (◻️) | pending (❓) | approved (✅) | rejected (❌)`.
* **VerificationEntry**: `{ clientId, direction, status, valueSnapshot, updatedAt }`.
* **HistoryEvent**: `{ clientId, direction, at, actorType(client|admin), action(submit|cancel|approve|reject|reset|editAddress), comment?, adminId? }`.
* **ClientCard** (админ‑лист): `{ clientId, lastActionAt, indicators: Record<direction, status>, progress: number }`.

---

## 11) Состояния кнопок (ключевые)

**Клиент:**

* «Подтвердить» — активно при выполненных предусловиях; недоступно на ❓/✅.
* «Отменить запрос» — доступно только на ❓ и до старта обработки.
* «Повторно» — доступно на ❌, после редактирования данных.

**Админ (в модалке):**

* На ❓: «Подтвердить» / «Отклонить» (комментарий обязателен при отказе).
* На ✅: read‑only; в секции «Верифицировано» доступен **«Сбросить верификацию»** (обязателен комментарий).
* «Карандаш» (правки адреса): только для вкладки **Адрес**; любые изменения → в историю.

---

## 12) Критерии приёмки (Acceptance Criteria)

1. Карточка в админ‑списках показывает **только ID**, время и 4 индикатора + `x/4`.
2. Все 4 секции админ‑панели **свёрнуты** по умолчанию; поиск работает сквозной и разворачивает целевой аккордион.
3. Единые статусы и их цвета/иконки совпадают для клиента и админа.
4. Поля клиента по направлению блокируются на **❓/✅** и доступны на **◻️/❌**.
5. На ❓ у клиента доступна **«Отменить запрос»**; на ❌ — показ комментария и **«Повторно»**.
6. Подтверждение направления изменяет прогресс; при **`4/4`** карточка перемещается в «Верифицировано».
7. Отклонение перемещает карточку в «Отказано»; повторная подача — обратно в «Запросы…».
8. Сброс направления из «Верифицировано» переводит карточку в «Частичную» и уменьшает прогресс (`4/4 → 3/4`).
9. История хранит полную хронологию по каждому направлению; клиент видит только текст отказов.
10. Для **Адреса** доступен «карандаш» с версионированием правок.

---

## 13) Примечания по реализации

* Поведение «начало обработки админом» фиксируется отдельным событием в истории; до него клиент может нажать «Отменить запрос».
* Проверка предусловий для кнопок «Подтвердить» должна быть синхронно отражена и в UI (подсветка полей, тултип), и на бэкенде (валидация).
* Все статусы и переходы должны быть **идемпотентными** (повторные клики не ломают состояние).
* Время везде хранится и показывается в едином формате; в админке дополнительно показывать относительное «X минут назад».

---

## 14) Чек‑лист для запуска

* [+] Единая модель статусов и переходов — удалил промежуточные статусы (`partial`, `reset`) из local-sim и UI, все данные нормализуются к `idle`/`pending`/`approved`/`rejected`.
* [ ] Блокировки полей у клиента по статусам.
* [ ] Кнопки и их состояния (клиент/админ) согласно разделу 11.
* [ ] Аккордионы админ‑панели (по умолчанию свёрнуты) + глобальный поиск.
* [ ] Карточка админа: только ID, время, индикаторы, прогресс.
* [ ] Модалка с 4 вкладками и историей; «карандаш» для Адреса.
* [ ] Сброс направления из «Верифицировано» (обязательный комментарий).
* [ ] Полная история действий с ролями; клиент видит только текст отказов.

---

**Готово.** Это полное структурированное описание твоего видения. Если нужно, подготовлю краткую «dev‑spec» по API событий и псевдокод по переходам статусов.
